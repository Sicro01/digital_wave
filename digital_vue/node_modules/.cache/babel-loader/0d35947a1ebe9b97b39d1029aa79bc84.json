{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport CardIcons from '@/components/shared/CardIcons';\n// import axios from 'axios'\n\nexport default {\n  name: 'CountryCard',\n  components: {\n    CardIcons\n  },\n  data() {\n    return {\n      tableHeaders: [],\n      tableItems: [],\n      tableItemLabels: [],\n      budgetValues: [],\n      countryChannelData: [],\n      locked: true,\n      valid: false,\n      rules: {\n        required: v => !!v || \"Required\",\n        notEmpty: v => v.toString().length > 0 || \"Budget should be between 0 and 10,000,000\",\n        inRange: v => Number.isInteger(Number(v)) && v >= 0 && v <= 10000000 || \"Budget should be between 0 and 10,000,000\"\n      }\n    };\n  },\n  computed: {\n    selectedPhase: {\n      get() {\n        return this.$store.state.selectedPhaseData.phase;\n      }\n    },\n    selectedStrategy: {\n      get() {\n        return this.$store.state.selectedStrategyData.strategy;\n      }\n    },\n    storedTargetCountries: {\n      get() {\n        return this.$store.state.storedTargetCountries;\n      }\n    },\n    storedTargetChannels: {\n      get() {\n        return this.$store.state.storedTargetChannels;\n      }\n    },\n    storedCountries: {\n      get() {\n        return this.$store.state.storedCountries;\n      }\n    },\n    storedChannels: {\n      get() {\n        return this.$store.state.storedChannels;\n      }\n    },\n    numberCountriesSelected: {\n      get() {\n        let count = 0;\n        this.items.forEach(item => {\n          item.include ? count++ : null;\n        });\n        console.log('count: ', count);\n        return count;\n      }\n    },\n    targetCountriesLastEdited: {\n      get() {\n        return new Date(Math.max(...this.storedTargetChannels.map(e => new Date(e.date_modified))));\n      }\n    }\n  },\n  watch: {\n    // async selectedStrategy(newValue) {\n    //     await this.getTargetCountries()\n    //     this.createItems()\n    // },\n  },\n  mounted() {\n    this.createTableHeaders();\n    this.createTableItemLabels();\n    this.createDataItems();\n  },\n  methods: {\n    createTableHeaders() {\n      // Header 1: Create Channel Header\n      var channelCodeHeader = {\n        text: 'Channel',\n        align: 'center',\n        sortable: false,\n        value: 'channelCode',\n        class: \"black--text text-subtitle-1\"\n      };\n      this.tableHeaders.push(channelCodeHeader);\n\n      // Headers 2 to nnn (2 header per country: \n      var index = 0;\n      this.storedTargetCountries.forEach(country => {\n        // Create a header for each country - where we'll place a checkbox \n        var countryHeader = {\n          text: country.code,\n          align: 'start',\n          sortable: false,\n          value: 'checked' + country.code + index,\n          class: \"black--text text-subtitle-1\"\n        };\n        this.tableHeaders.push(countryHeader);\n\n        // Create a header for each country budget - where we'll place a budget field\n        var budgetHeader = {\n          text: 'Budget',\n          align: 'center',\n          sortable: false,\n          value: \"budget\" + country.code + index,\n          class: \"black--text text-subtitle-1\"\n        };\n        this.tableHeaders.push(budgetHeader);\n\n        // Increment the count used to make the value field name unique\n        // This must match the field name in the actual table row\n        index += 1;\n      });\n      console.log('TargetChannelCard:createTableHeaders:tableHeaders: ', this.tableHeaders);\n    },\n    createTableItemLabels() {\n      // Create a label for each country and each country budget\n      // Used to unqiuely identify a country per channel - and the set the value of the checkbox when\n      // we create the data items\n      var index = 0;\n      this.storedTargetCountries.forEach(country => {\n        var checkBoxBudgetLabel = {\n          checked: 'checked' + country.code + index,\n          budget: 'budget' + country.code + index\n        };\n        this.tableItemLabels.push(checkBoxBudgetLabel);\n\n        // Increment the count used to make the value field name unique\n        // This must match the field name in the header row\n        index += 1;\n      });\n      console.log('TargetChannelCard:createTableItemLabels:tableItemLabels: ', this.tableItemLabels);\n    },\n    createDataItems() {\n      // Table Data\n      // Cycle through each country for each channel - creating:\n      // Value 1 - channel\n      // Value 2 & 3 per country (checkbox - with the checkboxValue label e.g. checkedDE01, checkedGB01) amd budget\n      console.log('TargetChannelCard:createDataItems:this.storedChannels: ', this.storedChannels);\n      this.storedChannels.forEach(channel => {\n        // Value 1: Channel\n        var item = {\n          'channelCode': channel.code\n        };\n        // Values 2 to nnn: Country check box AND budget field for each channel / country combination\n        var index = 0;\n        this.storedTargetCountries.forEach(country => {\n          // Set country / channel checkbox value\n          item = Object.assign({\n            [this.tableItemLabels[index].checked]: false\n          }, item);\n\n          // Set country / channel budget value\n          item = Object.assign({\n            [this.tableItemLabels[index].budget]: ''\n          }, item);\n          index += 1;\n        });\n        this.tableItems.push(item);\n        console.log('TargetChannelCard:createDataItems:item: ', item);\n      });\n      console.log('TargetChannelCard:createDataItems:tableItems: ', this.tableItems);\n      console.log('TargetChannelCard:createDataItems:this.storedChannels: ', this.storedChannels);\n      // console.log('tableItems: ', this.tableItems)\n    }\n  }\n};","map":{"version":3,"mappings":";AAsIA;AACA;;AAEA;EACAA;EACAC;IACAC;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;MACA;IACA;EACA;EACAC;IACAC;MACAC;QACA;MACA;IACA;IACAC;MACAD;QACA;MACA;IACA;IACAE;MACAF;QACA;MACA;IACA;IACAG;MACAH;QACA;MACA;IACA;IACAI;MACAJ;QACA;MACA;IACA;IACAK;MACAL;QACA;MACA;IACA;IACAM;MACAN;QACA;QACA;UACAO;QACA;QACAC;QACA;MACA;IACA;IACAC;MACAT;QACA;MACA;IACA;EACA;EACAU;IACA;IACA;IACA;IACA;EACA;EACAC;IACA;IACA;IACA;EACA;EACAC;IACAC;MACA;MACA;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACA;;MAEA;MACA;MACA;QACA;QACA;UACAJ;UACAC;UACAC;UACAC;UACAC;QACA;QACA;;QAEA;QACA;UACAJ;UACAC;UACAC;UACAC;UACAC;QACA;QACA;;QAEA;QACA;QACAC;MACA;MACAX;IACA;IACAY;MACA;MACA;MACA;MACA;MACA;QACA;UACAC;UACAC;QACA;QACA;;QAEA;QACA;QACAH;MACA;MACAX;IACA;IACAe;MACA;MACA;MACA;MACA;MACAf;MACA;QACA;QACA;UACA;QACA;QACA;QACA;QACA;UAEA;UACAD;YACA;UACA;;UAEA;UACAA;YACA;UACA;UAEAY;QACA;QACA;QACAX;MACA;MACAA;MACAA;MACA;IACA;EACA;AACA","names":["name","components","CardIcons","data","tableHeaders","tableItems","tableItemLabels","budgetValues","countryChannelData","locked","valid","rules","required","notEmpty","inRange","computed","selectedPhase","get","selectedStrategy","storedTargetCountries","storedTargetChannels","storedCountries","storedChannels","numberCountriesSelected","item","console","targetCountriesLastEdited","watch","mounted","methods","createTableHeaders","text","align","sortable","value","class","index","createTableItemLabels","checked","budget","createDataItems"],"sourceRoot":"src/components/targetchannel","sources":["TargetChannelCard.vue"],"sourcesContent":["<template>\r\n    <v-form\r\n        ref=\"form\"\r\n        v-model=\"valid\">\r\n        <v-card class=\"mt-3 mx-3\">\r\n            <v-card-title class=\"py-0\">\r\n                Select Channels and Set Budgets for Targeted Countries\r\n                <v-spacer></v-spacer>\r\n                <CardIcons\r\n                    :showEditIcon=\"true\"\r\n                    :showHideIcon=\"true\"\r\n                    @edit=\"(locked = !locked)\"\r\n                    @hide=\"$emit('hide')\"\r\n                    cardType=\"Linked Channels\" />\r\n            </v-card-title>\r\n            <v-divider></v-divider>\r\n            <v-card-text>\r\n                <v-row class=\"text--disabled\">\r\n                    <v-col cols=\"auto\" class=\"py-0 d-flex align-center\">Phase Budget:</v-col>\r\n                    <v-col cols=\"auto\" class=\"d-flex align-center\">\r\n                        <v-text-field\r\n                            :value=\"selectedPhase.budget\"\r\n                            label=\"Budget\"\r\n                            outlined\r\n                            dense\r\n                            disabled\r\n                            hide-details>\r\n                        </v-text-field>\r\n                        <v-col cols=\"auto\" class=\"py-0 d-flex align-center\">\r\n                            <v-text-field\r\n                                :value=\"selectedPhase.auto_allocate ? 'Yes' : 'No'\"\r\n                                label=\"Budget Autoallocated?\"\r\n                                outlined\r\n                                dense\r\n                                disabled\r\n                                hide-details>\r\n                            </v-text-field>\r\n                        </v-col>\r\n                    </v-col>\r\n                    <v-col cols=\"auto\" class=\"py-0 d-flex align-center\">Strategy Budget:</v-col>\r\n                    <v-col cols=\"auto\" class=\"d-flex align-center\">\r\n                        <v-text-field\r\n                            :value=\"selectedStrategy.budget\"\r\n                            label=\"Budget\"\r\n                            outlined\r\n                            dense\r\n                            disabled\r\n                            hide-details>\r\n                        </v-text-field>\r\n                        <v-col cols=\"auto\" class=\"py-0 d-flex align-center\">\r\n                            <v-text-field\r\n                                :value=\"selectedStrategy.auto_allocate ? 'Yes' : 'No'\"\r\n                                label=\"Budget Autoallocated?\"\r\n                                outlined\r\n                                dense\r\n                                disabled\r\n                                hide-details>\r\n                            </v-text-field>\r\n                        </v-col>\r\n                    </v-col>\r\n                </v-row>\r\n            </v-card-text>\r\n\r\n            <v-card-text>\r\n                <v-sheet\r\n                    class=\"mb-3 grey\"\r\n                    tile\r\n                    outlined>\r\n                    <v-data-table\r\n                        :headers=\"tableHeaders\"\r\n                        :items=\"tableItems\"\r\n                        hide-default-footer\r\n                        class=\"pb-3\">\r\n\r\n                        <template v-slot:body=\"{ items }\">\r\n                            <tbody>\r\n                                <tr v-for=\"(item, itemIndex) in items\" :key=\"itemIndex\">\r\n                                    <td>\r\n                                        {{ item.channelCode }}\r\n                                    </td>\r\n                                    <template v-for=\"(labels, labelIndex) in tableItemLabels\">\r\n                                        <td>\r\n                                            <v-checkbox\r\n                                                v-model=\"item[labels.checked]\"\r\n                                                color=\"secondary\"\r\n                                                dense\r\n                                                hide-details\r\n                                                @change=\"checkBoxChange(item, labels, labelIndex, itemIndex)\"></v-checkbox>\r\n                                        </td>\r\n                                        <td>\r\n                                            <v-text-field\r\n                                                :disabled=\"!item[labels.checked]\"\r\n                                                v-model=\"item[labels.budget]\"\r\n                                                @input=\"budgetFieldChange(item, labelIndex, $event)\"\r\n                                                label=\"Country / Channel Budget\"\r\n                                                type=\"number\"\r\n                                                dense\r\n                                                hide-details\r\n                                                class=\"shrink rounded-0\"\r\n                                                outlined>\r\n                                            </v-text-field>\r\n                                        </td>\r\n                                    </template>\r\n                                </tr>\r\n                            </tbody>\r\n                        </template>\r\n                    </v-data-table>\r\n                </v-sheet>\r\n                <div class=\"caption text--disabled\">\r\n                    <span>Last edit:{{ targetCountriesLastEdited.toLocaleDateString((\"en-GB\")) }}</span>\r\n                    <span> {{ targetCountriesLastEdited.toLocaleTimeString((\"en-GB\")) }}</span>\r\n                </div>\r\n            </v-card-text>\r\n            <v-card-actions v-if=\"!locked\">\r\n                <v-spacer></v-spacer>\r\n                <v-btn\r\n                    class=\"grey lighten-1 mr-3 rounded-0 text-capitalize\"\r\n                    light\r\n                    depressed\r\n                    @click=\"cancel\">\r\n                    Cancel\r\n                </v-btn>\r\n                <v-btn\r\n                    class=\"mr-3 success rounded-0 text-capitalize\"\r\n                    depressed\r\n                    :disabled=\"(!valid || numberCountriesSelected == 0)\"\r\n                    @click=\"save\">\r\n                    Save\r\n                </v-btn>\r\n            </v-card-actions>\r\n        </v-card>\r\n    </v-form>\r\n</template>\r\n<script>\r\nimport CardIcons from '@/components/shared/CardIcons'\r\n// import axios from 'axios'\r\n\r\nexport default {\r\n    name: 'CountryCard',\r\n    components: {\r\n        CardIcons,\r\n    },\r\n    data() {\r\n        return {\r\n            tableHeaders: [],\r\n            tableItems: [],\r\n            tableItemLabels: [],\r\n            budgetValues: [],\r\n            countryChannelData: [],\r\n            locked: true,\r\n            valid: false,\r\n            rules: {\r\n                required: (v => !!v || \"Required\"),\r\n                notEmpty: (v => (v.toString().length > 0) || \"Budget should be between 0 and 10,000,000\"),\r\n                inRange: (v => (Number.isInteger(Number(v)) && v >= 0 && v <= 10000000) || \"Budget should be between 0 and 10,000,000\"),\r\n            },\r\n        }\r\n    },\r\n    computed: {\r\n        selectedPhase: {\r\n            get() {\r\n                return this.$store.state.selectedPhaseData.phase\r\n            }\r\n        },\r\n        selectedStrategy: {\r\n            get() {\r\n                return this.$store.state.selectedStrategyData.strategy\r\n            }\r\n        },\r\n        storedTargetCountries: {\r\n            get() {\r\n                return this.$store.state.storedTargetCountries\r\n            }\r\n        },\r\n        storedTargetChannels: {\r\n            get() {\r\n                return this.$store.state.storedTargetChannels\r\n            }\r\n        },\r\n        storedCountries: {\r\n            get() {\r\n                return this.$store.state.storedCountries\r\n            }\r\n        },\r\n        storedChannels: {\r\n            get() {\r\n                return this.$store.state.storedChannels\r\n            }\r\n        },\r\n        numberCountriesSelected: {\r\n            get() {\r\n                let count = 0\r\n                this.items.forEach((item) => {\r\n                    item.include ? count++ : null\r\n                })\r\n                console.log('count: ', count)\r\n                return count\r\n            }\r\n        },\r\n        targetCountriesLastEdited: {\r\n            get() {\r\n                return new Date(Math.max(...this.storedTargetChannels.map(e => new Date(e.date_modified))));\r\n            }\r\n        },\r\n    },\r\n    watch: {\r\n        // async selectedStrategy(newValue) {\r\n        //     await this.getTargetCountries()\r\n        //     this.createItems()\r\n        // },\r\n    },\r\n    mounted() {\r\n        this.createTableHeaders()\r\n        this.createTableItemLabels()\r\n        this.createDataItems()\r\n    },\r\n    methods: {\r\n        createTableHeaders() {\r\n            // Header 1: Create Channel Header\r\n            var channelCodeHeader = {\r\n                text: 'Channel',\r\n                align: 'center',\r\n                sortable: false,\r\n                value: 'channelCode',\r\n                class: \"black--text text-subtitle-1\",\r\n            }\r\n            this.tableHeaders.push(channelCodeHeader)\r\n\r\n            // Headers 2 to nnn (2 header per country: \r\n            var index = 0\r\n            this.storedTargetCountries.forEach((country) => {\r\n                // Create a header for each country - where we'll place a checkbox \r\n                var countryHeader = {\r\n                    text: country.code,\r\n                    align: 'start',\r\n                    sortable: false,\r\n                    value: 'checked' + country.code + index,\r\n                    class: \"black--text text-subtitle-1\",\r\n                }\r\n                this.tableHeaders.push(countryHeader)\r\n\r\n                // Create a header for each country budget - where we'll place a budget field\r\n                var budgetHeader = {\r\n                    text: 'Budget',\r\n                    align: 'center',\r\n                    sortable: false,\r\n                    value: \"budget\" + country.code + index,\r\n                    class: \"black--text text-subtitle-1\",\r\n                }\r\n                this.tableHeaders.push(budgetHeader)\r\n\r\n                // Increment the count used to make the value field name unique\r\n                // This must match the field name in the actual table row\r\n                index += 1\r\n            })\r\n            console.log('TargetChannelCard:createTableHeaders:tableHeaders: ', this.tableHeaders)\r\n        },\r\n        createTableItemLabels() {\r\n            // Create a label for each country and each country budget\r\n            // Used to unqiuely identify a country per channel - and the set the value of the checkbox when\r\n            // we create the data items\r\n            var index = 0\r\n            this.storedTargetCountries.forEach((country) => {\r\n                var checkBoxBudgetLabel = {\r\n                    checked: 'checked' + country.code + index,\r\n                    budget: 'budget' + country.code + index\r\n                }\r\n                this.tableItemLabels.push(checkBoxBudgetLabel)\r\n\r\n                // Increment the count used to make the value field name unique\r\n                // This must match the field name in the header row\r\n                index += 1\r\n            })\r\n            console.log('TargetChannelCard:createTableItemLabels:tableItemLabels: ', this.tableItemLabels)\r\n        },\r\n        createDataItems() {\r\n            // Table Data\r\n            // Cycle through each country for each channel - creating:\r\n            // Value 1 - channel\r\n            // Value 2 & 3 per country (checkbox - with the checkboxValue label e.g. checkedDE01, checkedGB01) amd budget\r\n            console.log('TargetChannelCard:createDataItems:this.storedChannels: ', this.storedChannels)\r\n            this.storedChannels.forEach((channel) => {\r\n                // Value 1: Channel\r\n                var item = {\r\n                    'channelCode': channel.code,\r\n                }\r\n                // Values 2 to nnn: Country check box AND budget field for each channel / country combination\r\n                var index = 0\r\n                this.storedTargetCountries.forEach((country) => {\r\n\r\n                    // Set country / channel checkbox value\r\n                    item = Object.assign({\r\n                        [this.tableItemLabels[index].checked]: false,\r\n                    }, item)\r\n\r\n                    // Set country / channel budget value\r\n                    item = Object.assign({\r\n                        [this.tableItemLabels[index].budget]: '',\r\n                    }, item)\r\n\r\n                    index += 1\r\n                })\r\n                this.tableItems.push(item)\r\n                console.log('TargetChannelCard:createDataItems:item: ', item)\r\n            })\r\n            console.log('TargetChannelCard:createDataItems:tableItems: ', this.tableItems)\r\n            console.log('TargetChannelCard:createDataItems:this.storedChannels: ', this.storedChannels)\r\n            // console.log('tableItems: ', this.tableItems)\r\n        },\r\n    }\r\n}\r\n</script>\r\n\r\n<!-- // async getTargetCountries() {\r\n    //     var response = ''\r\n    //     try {\r\n    //         response = await axios.get(`api/v1/targetcountries`, {\r\n    //             params: {\r\n    //                 strategy: this.selectedStrategy.id,\r\n    //             }\r\n    //         })\r\n    //     }\r\n    //     catch (error) {\r\n    //         console.log(error)\r\n    //     }\r\n    //     // Refresh Strategy's Stored  Target Country data \r\n    //     this.$store.dispatch('storeTargetCountries', response.data)\r\n    // },\r\n    // createItems() {\r\n    //     this.items = []\r\n    //     // Table Data - check box AND budget field for each country\r\n    //     var index = 0\r\n    //     this.storedCountries.forEach((country) => {\r\n    //         var item = {\r\n    //             'id': country.id,\r\n    //             'country': country.name,\r\n    //             'include': false,\r\n    //             'budget': '',\r\n    //             'auto_allocate': false,\r\n    //         }\r\n    //         // See if this country is already a target country\r\n    //         let foundTargetCountry = this.storedTargetCountries.find(targetCountry =>\r\n    //             targetCountry.country == item.id\r\n    //         )\r\n    //         // Update table data item with target country settings\r\n    //         if (foundTargetCountry) {\r\n    //             item.include = true\r\n    //             item.budget = foundTargetCountry.budget\r\n    //             item.budget_allocated = foundTargetCountry.budget_allocated\r\n    //             item.auto_allocate = foundTargetCountry.auto_allocate\r\n    //         }\r\n    //         this.items.push(item)\r\n    //     })\r\n    // },\r\n    // save() {\r\n    //     // Build array of countries\r\n    //     this.locked = true\r\n    //     var targetCountries = []\r\n    //     console.log('save: ', this.items)\r\n    //     this.items.forEach((item) => {\r\n    //         if (item.include) {\r\n    //             let itemObj = {\r\n    //                 strategy: this.selectedStrategy.id,\r\n    //                 country: item.id,\r\n    //                 budget: item.budget,\r\n    //                 auto_allocate: item.auto_allocate,\r\n    //                 budget_allocated: 0,\r\n    //             }\r\n    //             targetCountries.push(itemObj)\r\n    //         }\r\n    //     })\r\n    //     this.$emit('update-target-countries', targetCountries)\r\n    // },\r\n    // cancel() {\r\n    //     this.locked = true\r\n    //     this.createItems()\r\n    // } -->"]},"metadata":{},"sourceType":"module"}